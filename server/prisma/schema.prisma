// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Utilisateur {
  id                 Int      @id @default(autoincrement())
  email              String   @unique
  hashPassword       String
  role               Role?
  employe            Employe  @relation(fields: [employeId], references: [id])
  employeId          Int      @unique
  dateCreationCompte DateTime @default(now())
}

enum Role {
  GESTIONNAIRE
  CHEF_MISSION
  CHEF_TERRAIN
  DIRECTEUR
  ADMINISTRATEUR
}

enum Sexe {
  Homme
  Femme
}

model Employe {
  id            Int          @id @default(autoincrement())
  dateAdhesion  DateTime     @db.Date
  etat          EtatEmploye  @relation(fields: [etatEmployeId], references: [id])
  etatEmployeId Int
  fonction      Fonction     @relation(fields: [fonctionId], references: [id])
  fonctionId    Int
  utilisateur   Utilisateur?
  nom           String
  prenom        String
  dateNaissance DateTime     @db.Date
  Equipe        Equipe?      @relation(fields: [equipeId], references: [id])
  equipeId      Int?
  sexe          Sexe
  numIdentite   String
  groupeSanguin String?
  Mission       Mission?     @relation(fields: [missionCode], references: [code])
  missionCode   String?
}

model EtatEmploye {
  id      Int       @id @default(autoincrement())
  nom     String
  Employe Employe[]
}

model Fonction {
  id      Int       @id @default(autoincrement())
  nom     String
  Employe Employe[]
}

model Projet {
  id Int @id @default(autoincrement())

  Plan Tache[]

  Etats EtatProjet[]

  Materiel    Materiel[]
  Mission     Mission     @relation(fields: [missionCode], references: [code])
  missionCode String
  createdAt   DateTime    @default(now())
  Coodonnes   Coordonne[]
  Executions  Execution[]
  Contrat     Contrat     @relation(fields: [contratNum], references: [num])
  contratNum  Int         @unique
}

model Client {
  id  Int    @id @default(autoincrement())
  nom String

  Contrat Contrat[]
}

model Contrat {
  num      Int      @id @default(autoincrement())
  debut    DateTime
  fin      DateTime
  Client   Client   @relation(fields: [clientId], references: [id])
  clientId Int
  Projet   Projet?
}

model EtatProjet {
  id           Int            @id @default(autoincrement())
  dPassageEtat DateTime       @default(now())
  etat         TypeEtatProjet
  Projet       Projet         @relation(fields: [projetId], references: [id])
  projetId     Int
}

enum TypeEtatProjet {
  PLANIFICATION
  EN_PRODUCTION
  CLOTURE
  ANNULE
}

model Objectif {
  id  Int    @id @default(autoincrement())
  nom String

  Taches Tache[]
}

model Tache {
  Projet     Projet   @relation(fields: [projetId], references: [id])
  Objectif   Objectif @relation(fields: [objectifId], references: [id])
  projetId   Int
  objectifId Int

  valeur String
  debut  DateTime @db.Date
  duree  Int

  @@id([projetId, objectifId])
}

model Coordonne {
  id        Int      @id @default(autoincrement())
  longitude Float
  latitude  Float
  Wilaya    Wilaya   @relation(fields: [numWilaya], references: [numero])
  numWilaya Int
  Projet    Projet[]
}

model Wilaya {
  numero    Int         @id
  nom       String
  Coordonne Coordonne[]
}

model Mission {
  code String      @id
  type TypeMission

  Executions Equipe[]
  Projet     Projet[]
  Chefs      Employe[]
}

enum TypeMission {
  MISSION2D
  MISSION3D
}

model Equipe {
  id         Int      @id @default(autoincrement())
  activite   Activite @relation(fields: [activiteId], references: [id])
  activiteId Int

  Mission   Mission @relation(fields: [missionId], references: [code])
  missionId String

  Membres    Employe[]
  Executions Execution[]
}

model Activite {
  id      Int      @id @default(autoincrement())
  nom     String
  Equipes Equipe[]
}

model Execution {
  Projet   Projet @relation(fields: [projetId], references: [id])
  projetId Int

  Equipe    Equipe   @relation(fields: [equipeId], references: [id])
  equipeId  Int
  hDebut    Int
  hFin      Int
  date      DateTime @unique @db.Date
  rendement Int

  @@id([projetId, equipeId])
}

model Materiel {
  code        String       @id
  designation String
  Projet      Projet?      @relation(fields: [projetId], references: [id])
  projetId    Int?
  enPanne     Boolean
  Reparations Reparation[]
}

model Reparation {
  id             Int       @id @default(autoincrement())
  dPanne         DateTime  @default(now())
  dRep           DateTime?
  detailProbleme String?
  Pannes         Panne[]
  Materiel       Materiel  @relation(fields: [materielCode], references: [code])
  materielCode   String
}

model Panne {
  id           Int        @id @default(autoincrement())
  titre        String
  cout         Float
  description  String
  Reparations  Reparation @relation(fields: [reparationId], references: [id])
  reparationId Int
}

model TypeMateriel {
  id  Int    @id @default(autoincrement())
  nom String
}

model Requisition {
  id         Int       @id @default(autoincrement())
  dateEnvoi  DateTime  @default(now())
  reponse    DateTime?
  desciption String
}

enum TypeEvenement {
  VOL
  ACCIDENT
}

model Evenement {
  id          Int           @id @default(autoincrement())
  type        TypeEvenement
  description String
}
